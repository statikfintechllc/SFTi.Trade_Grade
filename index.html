<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="msapplication-navbutton-color" content="#000000">
    <meta name="msapplication-TileColor" content="#000000">
    <link rel="manifest" href="system/js.on/manifest.json">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Crect width='32' height='32' rx='6' fill='%23cc0000'/%3E%3Cpath d='M8 10h6v2H8v-2zm0 4h8v2H8v-2zm0 4h10v2H8v-2z' fill='%23ff6666'/%3E%3Ccircle cx='22' cy='12' r='4' fill='%2300ff00'/%3E%3Cpath d='M22 10v4m-2-2h4' stroke='white' stroke-width='1.5' stroke-linecap='round'/%3E%3C/svg%3E">
    <link rel="apple-touch-icon" href="system/img/icon-192.png">
    <title>PREPARE Trading Journal</title>
    
    <!-- CSS Modules - Loaded in order -->
    <link rel="stylesheet" href="system/cs.+/base.css">
    <link rel="stylesheet" href="system/cs.+/menu.css">
    <link rel="stylesheet" href="system/cs.+/components.css">
    <link rel="stylesheet" href="system/cs.+/sliders.css">
    <link rel="stylesheet" href="system/cs.+/grading.css">
    <link rel="stylesheet" href="system/cs.+/modal.css">
    <link rel="stylesheet" href="system/cs.+/toast.css">
    <link rel="stylesheet" href="system/cs.+/chat.css">
    <link rel="stylesheet" href="system/cs.+/models.css">
    <link rel="stylesheet" href="system/cs.+/responsive.css">


</head>
<body>
    <!-- Toast Notification Container -->
    <div class="toast-container" id="toastContainer"></div>

    <div class="header">
        <button class="hamburger" onclick="toggleMenu()">
            <span class="hamburger-icon"></span>
        </button>
        <div class="header-title">
            <svg class="logo" viewBox="0 0 285 285" xmlns="http://www.w3.org/2000/svg">
                <rect x="0" y="0" width="285" height="285" rx="64" fill="#C0392B"/>
                <path d="M30 84 L60 94 L90 89 L120 79 L150 99 L180 94 L210 89 L240 84 L255 86" stroke="#FFA500" stroke-width="3" stroke-dasharray="6 4" fill="none" opacity="0.8"/>
                <rect x="33" y="104" width="12" height="36" fill="white"/>
                <line x1="39" y1="94" x2="39" y2="104" stroke="white" stroke-width="2.5"/>
                <line x1="39" y1="140" x2="39" y2="150" stroke="white" stroke-width="2.5"/>
                <rect x="58" y="114" width="12" height="28" fill="#212121"/>
                <line x1="64" y1="102" x2="64" y2="114" stroke="#212121" stroke-width="2.5"/>
                <line x1="64" y1="142" x2="64" y2="154" stroke="#212121" stroke-width="2.5"/>
                <rect x="83" y="99" width="12" height="42" fill="white"/>
                <line x1="89" y1="88" x2="89" y2="99" stroke="white" stroke-width="2.5"/>
                <line x1="89" y1="141" x2="89" y2="152" stroke="white" stroke-width="2.5"/>
                <rect x="108" y="74" width="12" height="52" fill="white"/>
                <line x1="114" y1="62" x2="114" y2="74" stroke="white" stroke-width="2.5"/>
                <line x1="114" y1="126" x2="114" y2="138" stroke="white" stroke-width="2.5"/>
                <rect x="133" y="94" width="12" height="38" fill="#212121"/>
                <line x1="139" y1="82" x2="139" y2="94" stroke="#212121" stroke-width="2.5"/>
                <line x1="139" y1="132" x2="139" y2="144" stroke="#212121" stroke-width="2.5"/>
                <rect x="158" y="109" width="12" height="30" fill="#212121"/>
                <line x1="164" y1="97" x2="164" y2="109" stroke="#212121" stroke-width="2.5"/>
                <line x1="164" y1="139" x2="164" y2="151" stroke="#212121" stroke-width="2.5"/>
                <rect x="183" y="102" width="12" height="34" fill="white"/>
                <line x1="189" y1="90" x2="189" y2="102" stroke="white" stroke-width="2.5"/>
                <line x1="189" y1="136" x2="189" y2="148" stroke="white" stroke-width="2.5"/>
                <rect x="208" y="80" width="12" height="48" fill="white"/>
                <line x1="214" y1="68" x2="214" y2="80" stroke="white" stroke-width="2.5"/>
                <line x1="214" y1="128" x2="214" y2="148" stroke="white" stroke-width="2.5"/>
                <rect x="233" y="60" width="12" height="44" fill="white"/>
                <line x1="239" y1="46" x2="239" y2="60" stroke="white" stroke-width="2.5"/>
                <line x1="239" y1="104" x2="239" y2="110" stroke="white" stroke-width="2.5"/>
                <path d="M15 174H270" stroke="white" stroke-width="4" stroke-linecap="round"/>
                <path d="M39 174V190L24 205" stroke="white" stroke-width="2.5" stroke-linecap="round" fill="none"/>
                <circle cx="24" cy="205" r="4" fill="white"/>
                <path d="M64 174V198L49 213" stroke="white" stroke-width="2.5" stroke-linecap="round" fill="none"/>
                <circle cx="49" cy="213" r="4" fill="white"/>
                <path d="M89 174V205" stroke="white" stroke-width="2.5" stroke-linecap="round" fill="none"/>
                <circle cx="89" cy="205" r="4" fill="white"/>
                <path d="M114 174V198L129 213" stroke="white" stroke-width="2.5" stroke-linecap="round" fill="none"/>
                <circle cx="129" cy="213" r="4" fill="white"/>
                <path d="M139 174V190L154 205" stroke="white" stroke-width="2.5" stroke-linecap="round" fill="none"/>
                <circle cx="154" cy="205" r="4" fill="white"/>
                <path d="M164 174V205" stroke="white" stroke-width="2.5" stroke-linecap="round" fill="none"/>
                <circle cx="164" cy="205" r="4" fill="white"/>
                <path d="M189 174V190L204 205" stroke="white" stroke-width="2.5" stroke-linecap="round" fill="none"/>
                <circle cx="204" cy="205" r="4" fill="white"/>
                <path d="M214 174V198L229 213" stroke="white" stroke-width="2.5" stroke-linecap="round" fill="none"/>
                <circle cx="229" cy="213" r="4" fill="white"/>
                <path d="M239 174V190L254 205" stroke="white" stroke-width="2.5" stroke-linecap="round" fill="none"/>
                <circle cx="254" cy="205" r="4" fill="white"/>
            </svg>
            <h1>SFTi P.R.E.P</h1>
        </div>
        <button class="copilot-header-btn" onclick="openAIFullscreen()" title="Open AI Assistant" aria-label="Open AI Assistant">
            <svg viewBox="0 0 16 16" fill="currentColor">
                <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
            </svg>
        </button>
    </div>

<div class="side-menu" id="sideMenu">
    <div class="menu-header">
        <div class="menu-logo">
            <svg class="logo" viewBox="0 0 285 285" xmlns="http://www.w3.org/2000/svg">
                <rect x="0" y="0" width="285" height="285" rx="64" fill="#C0392B"/>
                <path d="M30 84 L60 94 L90 89 L120 79 L150 99 L180 94 L210 89 L240 84 L255 86" stroke="#FFA500" stroke-width="3" stroke-dasharray="6 4" fill="none" opacity="0.8"/>
                <rect x="33" y="104" width="12" height="36" fill="white"/>
                <line x1="39" y1="94" x2="39" y2="104" stroke="white" stroke-width="2.5"/>
                <line x1="39" y1="140" x2="39" y2="150" stroke="white" stroke-width="2.5"/>
                <rect x="58" y="114" width="12" height="28" fill="#212121"/>
                <line x1="64" y1="102" x2="64" y2="114" stroke="#212121" stroke-width="2.5"/>
                <line x1="64" y1="142" x2="64" y2="154" stroke="#212121" stroke-width="2.5"/>
                <rect x="83" y="99" width="12" height="42" fill="white"/>
                <line x1="89" y1="88" x2="89" y2="99" stroke="white" stroke-width="2.5"/>
                <line x1="89" y1="141" x2="89" y2="152" stroke="white" stroke-width="2.5"/>
                <rect x="108" y="74" width="12" height="52" fill="white"/>
                <line x1="114" y1="62" x2="114" y2="74" stroke="white" stroke-width="2.5"/>
                <line x1="114" y1="126" x2="114" y2="138" stroke="white" stroke-width="2.5"/>
                <rect x="133" y="94" width="12" height="38" fill="#212121"/>
                <line x1="139" y1="82" x2="139" y2="94" stroke="#212121" stroke-width="2.5"/>
                <line x1="139" y1="132" x2="139" y2="144" stroke="#212121" stroke-width="2.5"/>
                <rect x="158" y="109" width="12" height="30" fill="#212121"/>
                <line x1="164" y1="97" x2="164" y2="109" stroke="#212121" stroke-width="2.5"/>
                <line x1="164" y1="139" x2="164" y2="151" stroke="#212121" stroke-width="2.5"/>
                <rect x="183" y="102" width="12" height="34" fill="white"/>
                <line x1="189" y1="90" x2="189" y2="102" stroke="white" stroke-width="2.5"/>
                <line x1="189" y1="136" x2="189" y2="148" stroke="white" stroke-width="2.5"/>
                <rect x="208" y="80" width="12" height="48" fill="white"/>
                <line x1="214" y1="68" x2="214" y2="80" stroke="white" stroke-width="2.5"/>
                <line x1="214" y1="128" x2="214" y2="148" stroke="white" stroke-width="2.5"/>
                <rect x="233" y="60" width="12" height="44" fill="white"/>
                <line x1="239" y1="46" x2="239" y2="60" stroke="white" stroke-width="2.5"/>
                <line x1="239" y1="104" x2="239" y2="110" stroke="white" stroke-width="2.5"/>
                <path d="M15 174H270" stroke="white" stroke-width="4" stroke-linecap="round"/>
                <path d="M39 174V190L24 205" stroke="white" stroke-width="2.5" stroke-linecap="round" fill="none"/>
                <circle cx="24" cy="205" r="4" fill="white"/>
                <path d="M64 174V198L49 213" stroke="white" stroke-width="2.5" stroke-linecap="round" fill="none"/>
                <circle cx="49" cy="213" r="4" fill="white"/>
                <path d="M89 174V205" stroke="white" stroke-width="2.5" stroke-linecap="round" fill="none"/>
                <circle cx="89" cy="205" r="4" fill="white"/>
                <path d="M114 174V198L129 213" stroke="white" stroke-width="2.5" stroke-linecap="round" fill="none"/>
                <circle cx="129" cy="213" r="4" fill="white"/>
                <path d="M139 174V190L154 205" stroke="white" stroke-width="2.5" stroke-linecap="round" fill="none"/>
                <circle cx="154" cy="205" r="4" fill="white"/>
                <path d="M164 174V205" stroke="white" stroke-width="2.5" stroke-linecap="round" fill="none"/>
                <circle cx="164" cy="205" r="4" fill="white"/>
                <path d="M189 174V190L204 205" stroke="white" stroke-width="2.5" stroke-linecap="round" fill="none"/>
                <circle cx="204" cy="205" r="4" fill="white"/>
                <path d="M214 174V198L229 213" stroke="white" stroke-width="2.5" stroke-linecap="round" fill="none"/>
                <circle cx="229" cy="213" r="4" fill="white"/>
                <path d="M239 174V190L254 205" stroke="white" stroke-width="2.5" stroke-linecap="round" fill="none"/>
                <circle cx="254" cy="205" r="4" fill="white"/>
            </svg>
            <div>
                <div class="menu-title">SFTi P.R.E.P</div>
                <div class="menu-subtitle">Disciplined Trading P.R.E.P & Review</div>
            </div>
        </div>
    </div>
    <div class="menu-nav">
        <button class="menu-btn active" onclick="switchView('grade')" id="gradeBtn">
            <svg class="icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
            </svg>
            <span>Grade Stock</span>
        </button>
        <button class="menu-btn" onclick="switchView('tracker')" id="trackerBtn">
            <svg class="icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            <span>Trade Plan</span>
        </button>
        <button class="menu-btn" onclick="switchView('finalize')" id="finalizeBtn">
            <svg class="icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 11 12 14 22 4"></polyline>
                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
            </svg>
            <span>Finalize Trades</span>
        </button>
        <button class="menu-btn" onclick="switchView('history')" id="historyBtn">
            <svg class="icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
            <span>History</span>
        </button>
        <button class="menu-btn" onclick="switchView('ai')" id="aiBtn">
            <svg class="icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2z"></path>
                <circle cx="7.5" cy="14.5" r="1.5" fill="currentColor"></circle>
                <circle cx="16.5" cy="14.5" r="1.5" fill="currentColor"></circle>
            </svg>
            <span>AI Assistant</span>
        </button>
        <button class="menu-btn" onclick="refreshServiceWorker()">
            <svg class="icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="23 4 23 10 17 10"></polyline>
                <polyline points="1 20 1 14 7 14"></polyline>
                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
            </svg>
            <span>Refresh</span>
        </button>
    </div>
</div>

                <path d="M12 8v4l3 3"/>
                <path d="M12 16h.01"/>
            </svg>
        </button>
        <div class="card compact-card">
            <input type="text" class="ticker-input" id="tickerInput" placeholder="ENTER TICKER" maxlength="10">
        </div>

        <div class="card score-display compact-card">
            <div class="score-value"><span id="totalScore">50</span>/100</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 50%"></div>
            </div>
        </div>

        <div class="card">
            <div class="slider-group">
                <div class="slider-header">
                    <div class="slider-label">
                        <div class="slider-title">P - Pattern/Price</div>
                        <div class="slider-subtitle">Technical setup quality</div>
                    </div>
                    <div class="slider-value" id="pattern-value">10</div>
                </div>  
                <input type="range" class="slider" min="1" max="20" value="10" id="pattern-slider" oninput="updateSlider('pattern', this.value, 20)">
                <div class="slider-range"><span>1</span><span>20</span></div>
            </div>

            <div class="slider-group">
                <div class="slider-header">
                    <div class="slider-label">
                        <div class="slider-title">R - Risk/Reward</div>
                        <div class="slider-subtitle">Trade R:R ratio</div>
                    </div>
                    <div class="slider-value" id="risk-value">10</div>
                </div>
                <input type="range" class="slider" min="1" max="20" value="10" id="risk-slider" oninput="updateSlider('risk', this.value, 20)">
                <div class="slider-range"><span>1</span><span>20</span></div>
            </div>

            <div class="slider-group">
                <div class="slider-header">
                    <div class="slider-label">
                        <div class="slider-title">E - Ease of Entry/Exit</div>
                        <div class="slider-subtitle">Liquidity & execution</div>
                    </div>
                    <div class="slider-value" id="entry-value">5</div>
                </div>
                <input type="range" class="slider" min="1" max="10" value="5" id="entry-slider" oninput="updateSlider('entry', this.value, 10)">
                <div class="slider-range"><span>1</span><span>10</span></div>
            </div>

            <div class="slider-group">
                <div class="slider-header">
                    <div class="slider-label">
                        <div class="slider-title">P - Past Performance</div>
                        <div class="slider-subtitle">History of spiking</div>
                    </div>
                    <div class="slider-value" id="performance-value">5</div>
                </div>
                <input type="range" class="slider" min="1" max="10" value="5" id="performance-slider" oninput="updateSlider('performance', this.value, 10)">
                <div class="slider-range"><span>1</span><span>10</span></div>
            </div>

            <div class="slider-group">
                <div class="slider-header">
                    <div class="slider-label">
                        <div class="slider-title">A - At What Time Is It?</div>
                        <div class="slider-subtitle">Personal schedule fit</div>
                    </div>
                    <div class="slider-value" id="time-value">10</div>
                </div>
                <input type="range" class="slider" min="1" max="20" value="10" id="time-slider" oninput="updateSlider('time', this.value, 20)">
                <div class="slider-range"><span>1</span><span>20</span></div>
            </div>

            <div class="slider-group">
                <div class="slider-header">
                    <div class="slider-label">
                        <div class="slider-title">R - Reason/Catalyst</div>
                        <div class="slider-subtitle">News or event driver</div>
                    </div>
                    <div class="slider-value" id="catalyst-value">5</div>
                </div>
                <input type="range" class="slider" min="1" max="10" value="5" id="catalyst-slider" oninput="updateSlider('catalyst', this.value, 10)">
                <div class="slider-range"><span>1</span><span>10</span></div>
            </div>

            <div class="slider-group">
                <div class="slider-header">
                    <div class="slider-label">
                        <div class="slider-title">E - Market Environment</div>
                        <div class="slider-subtitle">Overall market conditions</div>
                    </div>
                    <div class="slider-value" id="environment-value">5</div>
                </div>
                <input type="range" class="slider" min="1" max="10" value="5" id="environment-slider" oninput="updateSlider('environment', this.value, 10)">
                <div class="slider-range"><span>1</span><span>10</span></div>
            </div>
        </div>

        <div class="card">
            <input type="file" id="screenshotInput" accept="image/*" style="display: none;">
            <div id="screenshotPreview" style="display: none; margin-bottom: 8px; position: relative;">
                <img id="previewImg" style="width: 100%; border-radius: 6px; border: 1px solid #333;">
                <button id="clearScreenshotBtn" style="position: absolute; top: 4px; right: 4px; background: rgba(204,0,0,0.9); border: none; color: white; width: 24px; height: 24px; border-radius: 50%; cursor: pointer; font-size: 14px;">Ã—</button>
            </div>
            <button id="addScreenshotBtn" class="save-btn" style="padding: 8px; background: linear-gradient(135deg, #333 0%, #222 100%);">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                    <polyline points="21 15 16 10 5 21"></polyline>
                </svg>
                <span id="screenshotBtnText">Add Screenshot</span>
            </button>
        </div>

        <button class="save-btn" onclick="continueToTracker()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 16 16 12 12 8"></polyline>
                <line x1="8" y1="12" x2="16" y2="12"></line>
            </svg>
            Continue
                <path d="M12 8v4l3 3"/>
                <path d="M12 16h.01"/>
            </svg>
        </button>
        <div class="card" style="background: linear-gradient(135deg, rgba(40, 40, 40, 0.9) 0%, rgba(20, 20, 20, 0.95) 100%); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1);">
            <div class="card-title" style="display: flex; align-items: center; gap: 8px;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#cc0000" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                Trade Plan Builder
            </div>
            
            <div id="trackerTickerDisplay" style="text-align: center; margin-bottom: 12px;">
                <span style="font-size: 24px; font-weight: 700; color: white;" id="trackerTickerLabel">---</span>
                <span style="font-size: 12px; color: #888; display: block;">Score: <span id="trackerScoreLabel">--</span>/100</span>
            </div>

            <div class="slider-group">
                <div class="slider-header">
                    <div class="slider-label">
                        <div class="slider-title" style="color: #ffcc00;">ðŸ’° Ideal Entry Price</div>
                    </div>
                </div>
                <input type="number" class="ticker-input" id="entryPriceInput" placeholder="Enter price (e.g., 1.05)" step="0.01" min="0.01" max="10000" style="text-transform: none; font-size: 16px; text-align: center;">
            </div>

            <div class="slider-group">
                <div class="slider-header">
                    <div class="slider-label">
                        <div class="slider-title" style="color: #ff4444;">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 4px;">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="15" y1="9" x2="9" y2="15"></line>
                                <line x1="9" y1="9" x2="15" y2="15"></line>
                            </svg>
                            Stop Loss
                        </div>
                        <div class="slider-subtitle" style="display: block;">Protect your capital</div>
                    </div>
                    <div class="slider-value" style="color: #ff4444;" id="stopLoss-value">7%</div>
                </div>
                <input type="range" class="slider" min="5" max="10" value="7" step="0.5" id="stopLoss-slider" oninput="updateTrackerSlider('stopLoss', this.value)" style="background: linear-gradient(to right, #ff4444 0%, #ff4444 40%, #1a1a1a 40%, #1a1a1a 100%);">
                <div style="display: flex; justify-content: space-between; font-size: 10px; color: #666; margin-top: 2px;">
                    <span>5%</span>
                    <span id="stopPriceDisplay" style="color: #ff4444; font-weight: 600;">$0.00</span>
                    <span>10%</span>
                </div>
            </div>

            <div class="slider-group">
                <div class="slider-header">
                    <div class="slider-label">
                        <div class="slider-title" style="color: #00ff00;">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 4px;">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M12 8v8m-4-4h8"></path>
                            </svg>
                            Profit Target
                        </div>
                        <div class="slider-subtitle" style="display: block;">Set your goal</div>
                    </div>
                    <div class="slider-value" style="color: #00ff00;" id="profitTarget-value">20%</div>
                </div>
                <input type="range" class="slider" min="15" max="30" value="20" step="1" id="profitTarget-slider" oninput="updateTrackerSlider('profitTarget', this.value)" style="background: linear-gradient(to right, #00ff00 0%, #00ff00 33%, #1a1a1a 33%, #1a1a1a 100%);">
                <div style="display: flex; justify-content: space-between; font-size: 10px; color: #666; margin-top: 2px;">
                    <span>15%</span>
                    <span id="targetPriceDisplay" style="color: #00ff00; font-weight: 600;">$0.00</span>
                    <span>30%</span>
                </div>
            </div>

            <div class="slider-group">
                <div class="slider-header">
                    <div class="slider-label">
                        <div class="slider-title" style="color: #6495ed; display: flex; align-items: center; gap: 6px;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#6495ed" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            </svg>
                            <span>Trade Thoughts</span>
                        </div>
                        <div class="slider-subtitle" style="display: block;">What are you thinking?</div>
                    </div>
                </div>
                <textarea class="ticker-input" id="tradeThoughtsInput" placeholder="Write down your thoughts about this trade..." style="text-transform: none; font-size: 12px; min-height: 80px; resize: vertical; line-height: 1.4;"></textarea>
            </div>
        </div>

        <div class="card" style="background: linear-gradient(135deg, rgba(0, 100, 0, 0.2) 0%, rgba(100, 0, 0, 0.2) 100%); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.15);">
            <div style="text-align: center;">
                <div style="font-size: 11px; color: #888; margin-bottom: 4px;">RISK / REWARD RATIO</div>
                <div style="font-size: 36px; font-weight: 700; color: white;" id="rrRatioDisplay">
                    <span id="rrRatioValue">0.0</span><span style="font-size: 18px; color: #888;">:1</span>
                </div>
                <div id="rrQuality" style="font-size: 12px; margin-top: 4px; padding: 4px 12px; border-radius: 12px; display: inline-block;">--</div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-top: 12px; text-align: center;">
                <div style="background: rgba(255, 204, 0, 0.15); padding: 8px; border-radius: 8px; border: 1px solid rgba(255, 204, 0, 0.3);">
                    <div style="font-size: 10px; color: #ffcc00; margin-bottom: 2px;">ENTRY</div>
                    <div style="font-size: 14px; font-weight: 600; color: white;" id="summaryEntry">$0.00</div>
                </div>
                <div style="background: rgba(255, 68, 68, 0.15); padding: 8px; border-radius: 8px; border: 1px solid rgba(255, 68, 68, 0.3);">
                    <div style="font-size: 10px; color: #ff4444; margin-bottom: 2px;">STOP</div>
                    <div style="font-size: 14px; font-weight: 600; color: white;" id="summaryStop">$0.00</div>
                </div>
                <div style="background: rgba(0, 255, 0, 0.15); padding: 8px; border-radius: 8px; border: 1px solid rgba(0, 255, 0, 0.3);">
                    <div style="font-size: 10px; color: #00ff00; margin-bottom: 2px;">TARGET</div>
                    <div style="font-size: 14px; font-weight: 600; color: white;" id="summaryTarget">$0.00</div>
                </div>
            </div>
        </div>

        <button class="save-btn" onclick="saveTradePlan()" style="background: linear-gradient(135deg, #00aa00 0%, #006600 100%); box-shadow: 0 4px 15px rgba(0, 170, 0, 0.3);">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                <polyline points="17 21 17 13 7 13 7 21"></polyline>
                <polyline points="7 3 7 8 15 8"></polyline>
            </svg>
            Save Trade Plan
        </button>

        <button class="save-btn" onclick="switchView('grade')" style="margin-top: 8px; background: linear-gradient(135deg, #333 0%, #222 100%);">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="19" y1="12" x2="5" y2="12"></line>
                <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
            Back to Grade
                <path d="M12 8v4l3 3"/>
                <path d="M12 16h.01"/>
            </svg>
        </button>
        <h2 style="font-size: 18px; font-weight: 700; color: white; margin-bottom: 12px;">Finalize Trades</h2>
        
        <div class="card" style="margin-bottom: 12px; background: linear-gradient(135deg, rgba(40, 40, 40, 0.9) 0%, rgba(20, 20, 20, 0.95) 100%); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);">
            <div style="font-size: 11px; color: #888; line-height: 1.5;">
                <p>Review and finalize your planned trades. Mark trades as <span style="color: #ff4444; font-weight: 600;">Rejected</span> (not taken) or <span style="color: #00ff00; font-weight: 600;">Accepted</span> (executed) to track your results.</p>
            </div>
        </div>
        
                <path d="M12 8v4l3 3"/>
                <path d="M12 16h.01"/>
            </svg>
        </button>
        <h2 style="font-size: 18px; font-weight: 700; color: white; margin-bottom: 12px;">Trade History</h2>
        
        <div class="card" style="margin-bottom: 12px; background: linear-gradient(135deg, rgba(40, 40, 40, 0.9) 0%, rgba(20, 20, 20, 0.95) 100%); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); padding: 8px;">
            <div style="background: rgba(26, 26, 26, 0.8); border: 2px solid rgba(255, 255, 255, 0.08); border-radius: 12px; padding: 8px; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);">
                <input type="text" class="ticker-input" id="historySearchInput" placeholder="Search ticker..." style="width: 100%; padding: 12px 14px; font-size: 14px; border: none; background: transparent; margin-bottom: 8px; border-bottom: 1px solid rgba(255, 255, 255, 0.08);">
                <div style="display: flex; gap: 6px; align-items: center;">
                    <select id="historyGradeFilter" class="ticker-input" style="flex: 1; padding: 10px 8px; font-size: 13px; text-transform: none; border-radius: 8px; background: rgba(40, 40, 40, 0.6); border: 1px solid rgba(255, 255, 255, 0.1); height: 38px;">
                        <option value="">All Grades</option>
                        <option value="A">A (90+)</option>
                        <option value="B">B (75-89)</option>
                        <option value="C">C (60-74)</option>
                        <option value="D">D (Below 60)</option>
                    </select>
                    <select id="historyStatusFilter" class="ticker-input" style="flex: 1; padding: 10px 8px; font-size: 13px; text-transform: none; border-radius: 8px; background: rgba(40, 40, 40, 0.6); border: 1px solid rgba(255, 255, 255, 0.1); height: 38px;">
                        <option value="">All Status</option>
                        <option value="finalized">Finalized</option>
                        <option value="non-finalized">Non-Finalized</option>
                    </select>
                    <select id="historyStrategyFilter" class="ticker-input" style="flex: 1; padding: 10px 8px; font-size: 13px; text-transform: none; border-radius: 8px; background: rgba(40, 40, 40, 0.6); border: 1px solid rgba(255, 255, 255, 0.1); height: 38px;">
                        <option value="">All Strategies</option>
                    </select>
                    <button class="save-btn" onclick="filterHistory()" aria-label="Search" style="flex: 0 0 auto; padding: 8px; font-size: 12px; border-radius: 8px; width: 38px; height: 38px; display: flex; align-items: center; justify-content: center;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        
        <div id="historyContainer"></div>
    </div>

    <div id="aiView" style="display: none;">
        <h2 id="aiViewTitle" style="font-size: 14px; font-weight: 700; color: white; margin-bottom: 6px;">AI Trading Assistant</h2>
        
        <!-- Token Access Cards - Two side by side (compact) -->
        <div id="aiViewTokenCards" style="display: flex; gap: 8px; margin-bottom: 6px;">
            <!-- GitHub Token Card - Compact with real-time status -->
            <div class="card" style="flex: 1; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 10px 8px;" onclick="showGithubTokenModal()" aria-label="Configure GitHub token">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" style="color: #e0e0e0; margin-bottom: 4px;">
                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
                <div id="githubTokenStatus" style="text-align: center;">
                    <div style="font-size: 10px; font-weight: 600; color: #888;">GitHub Token</div>
                    <div id="githubTokenStatusText" style="font-size: 9px; color: #666; margin-top: 1px;">Click to configure</div>
                </div>
            </div>
            
            <!-- Market API Card - Compact Starlink-style with Coming Soon modal -->
            <div class="card" style="flex: 1; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 10px 8px;" onclick="showMarketApiModal()" aria-label="Configure Market API">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="color: #e0e0e0; margin-bottom: 4px;">
                    <!-- Starlink-inspired satellite/connection icon -->
                    <circle cx="12" cy="12" r="3" fill="currentColor"/>
                    <path d="M12 2v3" stroke-linecap="round"/>
                    <path d="M12 19v3" stroke-linecap="round"/>
                    <path d="M2 12h3" stroke-linecap="round"/>
                    <path d="M19 12h3" stroke-linecap="round"/>
                    <path d="M4.93 4.93l2.12 2.12" stroke-linecap="round"/>
                    <path d="M16.95 16.95l2.12 2.12" stroke-linecap="round"/>
                    <path d="M4.93 19.07l2.12-2.12" stroke-linecap="round"/>
                    <path d="M16.95 7.05l2.12-2.12" stroke-linecap="round"/>
                    <circle cx="12" cy="12" r="8" stroke-dasharray="4 2"/>
                </svg>
                <div id="marketApiStatus" style="text-align: center;">
                    <div style="font-size: 10px; font-weight: 600; color: #888;">Market API</div>
                    <div id="marketApiStatusText" style="font-size: 9px; color: #666; margin-top: 1px;">Token Needed</div>
                </div>
            </div>
        </div>
        
        <!-- Usage & Stats Card (compact) -->
        <div id="aiViewStatsCard" class="card" style="margin-bottom: 6px; padding: 8px 12px;">
            <label class="label-text" style="margin-bottom: 6px;">Usage & Stats</label>
            <div class="usage-stats-card">
                <div class="usage-stat-item">
                    <div class="usage-stat-value" id="statMessages">0</div>
                    <div class="usage-stat-label">Messages</div>
                </div>
                <div class="usage-stat-item">
                    <div class="usage-stat-value" id="statSearches">0</div>
                    <div class="usage-stat-label">Web Searches</div>
                </div>
                <div class="usage-stat-item">
                    <div class="usage-stat-value" id="statTokensUsed">0</div>
                    <div class="usage-stat-label">Tokens Used</div>
                </div>
                <div class="usage-stat-item">
                    <div class="usage-stat-value" id="statModel">--</div>
                    <div class="usage-stat-label">Active Model</div>
                </div>
            </div>
        </div>

        <!-- Chat Window - Fixed at bottom when AI view is active -->
        <div class="chat-window-container" id="chatWindow" style="display: none;">
            <div class="chat-model-bar">
                <!-- Chat History Button (Left) -->
                <button class="chat-floating-btn chat-history-btn" onclick="toggleChatHistoryDropdown(event)" title="Chat History" aria-label="Chat History">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                </button>
                <!-- Chat History Dropdown -->
                <div id="chatHistoryDropdown" class="chat-history-dropdown">
                    <div class="chat-history-header">Chat History</div>
                    <div id="chatHistoryList" class="chat-history-list">
                        <!-- Chat history items will be populated dynamically -->
                    </div>
                </div>
                
                <!-- Custom Model Dropdown -->
                <div class="model-dropdown-wrapper" id="modelDropdownWrapper">
                    <button class="model-dropdown-trigger" id="modelDropdownTrigger" onclick="toggleModelDropdown(event)" disabled title="Select AI model" aria-label="AI Model Selector - Save GitHub token to load available models">
                        <span class="model-name">Save token to load models</span>
                    </button>
                    <div class="model-dropdown-menu" id="modelDropdownMenu">
                        <!-- Model items will be populated dynamically -->
                    </div>
                </div>
                <!-- Hidden select for form compatibility -->
                <select id="chatModelSelect" style="display: none;">
                    <option value="">Save GitHub token to load models</option>
                </select>
                
                <!-- New Chat Button (Right) -->
                <button class="chat-floating-btn chat-new-btn" onclick="startNewChat()" title="New Chat" aria-label="New Chat">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                </button>
            </div>
            <!-- Fullscreen Toggle Button - centered below model dropdown -->
            <button id="fullscreenChatBtn" class="fullscreen-chat-btn" onclick="toggleFullscreenChat()" title="Toggle Fullscreen" aria-label="Toggle Fullscreen Chat">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>
                </svg>
            </button>
            <div class="chat-messages" id="chatMessagesContainer">
                <div class="chat-empty-state">
                    <div class="chat-empty-icon">ðŸ’¬</div>
                    <div class="chat-empty-text">Start a conversation</div>
                    <div class="chat-empty-subtext">Ask about trades, patterns, or market sentiment</div>
                </div>
            </div>
            <div class="chat-input-bar">
                <!-- Live Status Indicator - shown during web search operations -->
                <div id="chatStatusIndicator" class="chat-status-indicator" style="display: none;">
                    <div class="status-spinner"></div>
                    <span class="status-text">Thinking...</span>
                </div>
                <div class="chat-input-wrapper">
                    <textarea 
                        id="aiPrompt" 
                        class="chat-textarea" 
                        placeholder="Review the Markets..."
                        rows="1"
                        onkeydown="handleChatKeyPress(event)"
                        oninput="autoResizeTextarea(this)"></textarea>
                    <div class="chat-controls">
                        <!-- More Menu Button - Quick Actions (moved to left) -->
                        <div class="more-menu-btn" onclick="toggleQuickActionsPopup(event)" title="Quick Actions" aria-label="Quick Actions">
                            <svg viewBox="0 0 24 24" fill="currentColor" stroke="none">
                                <circle cx="12" cy="5" r="2"></circle>
                                <circle cx="12" cy="12" r="2"></circle>
                                <circle cx="12" cy="19" r="2"></circle>
                            </svg>
                            <!-- Quick Actions Popup -->
                            <div id="quickActionsPopup" class="quick-actions-popup">
                                <button class="quick-action-item" onclick="reviewGrades(); hideQuickActionsPopup();">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18M9 21V9"/></svg>
                                    Review Grades
                                </button>
                                <button class="quick-action-item" onclick="findPatterns(); hideQuickActionsPopup();">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
                                    Find Patterns
                                </button>
                                <button class="quick-action-item" onclick="getSentiment(); hideQuickActionsPopup();">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
                                    Market Sentiment
                                </button>
                                <button class="quick-action-item" onclick="showTickerModal(); hideQuickActionsPopup();">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
                                    Analyze Ticker
                                </button>
                            </div>
                        </div>
                        <!-- File Attach Button (moved to left after More button) -->
                        <input type="file" id="chatFileInput" class="chat-file-input" accept="image/*,.pdf,.json,.txt,.csv,.md,.doc,.docx,.xls,.xlsx" onchange="handleChatFileUpload(this)">
                        <div id="fileAttachBtn" class="file-attach-btn" onclick="triggerFileUpload(event)" title="Attach file" aria-label="Attach file">
                            <svg class="file-attach-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path>
                            </svg>
                        </div>
                        <!-- Spacer to push remaining buttons to the right -->
                        <div style="flex: 1;"></div>
                        <!-- Web Search Toggle - SVG only (right side) -->
                        <button id="webSearchToggle" class="web-search-toggle chat-icon-btn" type="button" onclick="toggleWebSearch(event)" title="Toggle web search" aria-label="Toggle web search">
                            <svg class="web-search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="2" y1="12" x2="22" y2="12"></line>
                                <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                            </svg>
                        </button>
                        <!-- Send Button (right side) -->
                        <button class="chat-icon-btn chat-send-icon-btn" onclick="askAI()" id="chatSendBtn" title="Send message" aria-label="Send message">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="22" y1="2" x2="11" y2="13"></line>
                                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- iOS Liquid Glass Style Ticker Modal -->
<div class="modal-overlay" id="tickerModal">
    <div class="modal-content">
        <div class="modal-title">Analyze Ticker</div>
        <input type="text" class="modal-input" id="tickerModalInput" placeholder="Enter symbol (e.g., AAPL)" maxlength="10">
        <div class="modal-buttons">
            <button class="modal-btn modal-btn-cancel" onclick="hideTickerModal()">Cancel</button>
            <button class="modal-btn modal-btn-confirm" onclick="confirmTickerAnalysis()">Analyze</button>
        </div>
    </div>
</div>

<!-- Trade Details Modal -->
<div class="modal-overlay" id="tradeDetailsModal">
    <div class="modal-content" style="max-width: 400px; max-height: 80vh; overflow-y: auto;">
        <div class="modal-title" id="tradeDetailsTitle">Trade Details</div>
        <div id="tradeDetailsContent" style="font-size: 12px; color: #e0e0e0; line-height: 1.6;">
            <!-- Content will be populated dynamically -->
        </div>
        <div class="modal-buttons" style="margin-top: 16px;">
            <button class="modal-btn modal-btn-cancel" onclick="hideTradeDetailsModal()" style="width: 100%;">Close</button>
        </div>
    </div>
</div>

<!-- Finalize Trade Modal -->
<div class="modal-overlay" id="finalizeTradeModal">
    <div class="modal-content" style="max-width: 400px;">
        <div class="modal-title">Finalize Trade: <span id="finalizeModalTicker"></span></div>
        <div id="finalizeModalContent" style="font-size: 12px; color: #e0e0e0; margin-bottom: 16px;">
            <!-- Initial choice or detailed finalization form -->
        </div>
        <div id="finalizeModalButtons" class="modal-buttons">
            <!-- Buttons will be populated dynamically -->
        </div>
    </div>
</div>

<!-- Full Screen Image Viewer Modal -->
<div class="modal-overlay" id="imageViewerModal" style="background: rgba(0, 0, 0, 0.95); cursor: pointer;">
    <button onclick="hideImageViewer()" aria-label="Close image viewer" style="position: fixed; top: 60px; right: 20px; background: rgba(255, 255, 255, 0.2); border: none; color: white; width: 44px; height: 44px; border-radius: 50%; cursor: pointer; font-size: 24px; z-index: 101; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); display: flex; align-items: center; justify-content: center;">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
    </button>
    <img id="fullScreenImage" src="" style="max-width: 90%; max-height: 90%; object-fit: contain; border-radius: 8px; cursor: default;" onclick="event.stopPropagation();" alt="Full screen view">
</div>

<!-- GitHub Token Modal -->
<!-- GitHub Token Modal - Mirrors Market API Modal Structure -->
<div class="modal-overlay" id="githubTokenModal">
    <div class="modal-content" style="max-width: 420px; position: relative; max-height: 85vh; overflow-y: auto; -webkit-overflow-scrolling: touch;">
        <!-- Close X Button -->
        <button onclick="hideGithubTokenModal()" style="position: absolute; top: 10px; right: 10px; background: none; border: none; cursor: pointer; padding: 4px; border-radius: 4px;" aria-label="Close modal">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#888" stroke-width="2" stroke-linecap="round">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
        </button>
        <div class="modal-title">GitHub Configuration</div>
        <div style="text-align: center; padding: 12px 0;">
            <!-- GitHub Mark SVG -->
            <svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor" style="color: #fff; margin-bottom: 8px;">
                <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
            </svg>
        </div>
        
        <!-- GitHub Token Input Section -->
        <div style="background: rgba(0,0,0,0.3); border-radius: 8px; padding: 10px; margin-bottom: 12px;">
            <div style="font-size: 9px; font-weight: 600; color: #fff; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 6px;">Personal Access Token</div>
            <p style="font-size: 9px; color: #888; margin-bottom: 8px;">Enter your GitHub personal access token for AI model access</p>
            <input type="password" class="modal-input" id="githubTokenInput" placeholder="ghp_..." style="margin-bottom: 8px;">
            <div style="display: flex; gap: 6px;">
                <button class="modal-btn modal-btn-cancel" onclick="hideGithubTokenModal()" style="flex: 1;">Close</button>
                <button class="modal-btn modal-btn-confirm" onclick="saveGithubToken()" style="flex: 1;">Save Token</button>
            </div>
        </div>
        
        <!-- Static Backend Status -->
        <div style="background: rgba(0,191,165,0.1); border: 1px solid rgba(0,191,165,0.3); border-radius: 8px; padding: 10px; margin-bottom: 12px;">
            <div style="font-size: 9px; font-weight: 600; color: #00bfa5; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 6px;">Static Backend Server</div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 3px;">
                <span style="font-size: 10px; color: #888;">Status:</span>
                <span id="staticBackendStatus" style="font-size: 10px; color: #4caf50;">â— Active</span>
            </div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 3px;">
                <span style="font-size: 10px; color: #888;">Azure Models:</span>
                <span style="font-size: 10px; color: #fff;">3 Available</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
                <span style="font-size: 10px; color: #888;">Copilot Models:</span>
                <span id="copilotModelStatus" style="font-size: 10px; color: #888;">Auth Required</span>
            </div>
        </div>
        
        <!-- OAuth Client ID & Secret Configuration -->
        <div style="background: rgba(204,0,0,0.1); border: 1px solid rgba(204,0,0,0.3); border-radius: 8px; padding: 10px; margin-bottom: 12px;">
            <div style="font-size: 9px; font-weight: 600; color: #cc0000; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 6px;">GitHub OAuth App</div>
            <p style="font-size: 9px; color: #888; margin-bottom: 8px;">Enter your OAuth App credentials from GitHub Settings â†’ Developer Settings â†’ OAuth Apps</p>
            
            <!-- Client ID -->
            <div style="margin-bottom: 8px;">
                <label style="font-size: 8px; color: #666; display: block; margin-bottom: 3px;">Client ID</label>
                <input type="text" id="oauthClientIdInput" placeholder="Ov23li..." 
                    style="width: 100%; padding: 8px 10px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: #e0e0e0; font-size: 11px; font-family: monospace; box-sizing: border-box;"
                    value="">
            </div>
            
            <!-- Client Secret -->
            <div style="margin-bottom: 8px;">
                <label style="font-size: 8px; color: #666; display: block; margin-bottom: 3px;">Client Secret</label>
                <input type="password" id="oauthClientSecretInput" placeholder="40-character hex string" 
                    style="width: 100%; padding: 8px 10px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: #e0e0e0; font-size: 11px; font-family: monospace; box-sizing: border-box;"
                    value="">
            </div>
            
            <button onclick="saveOAuthCredentials()" style="width: 100%; padding: 8px 12px; background: linear-gradient(135deg, #cc0000 0%, #990000 100%); border: none; border-radius: 6px; color: white; font-size: 10px; font-weight: 600; cursor: pointer;">
                Save Credentials
            </button>
            <div id="oauthClientIdStatus" style="font-size: 9px; color: #666; margin-top: 6px;"></div>
        </div>
        
        <!-- GitHub Copilot OAuth Section -->
        <div style="background: rgba(100,100,100,0.1); border: 1px solid rgba(100,100,100,0.2); border-radius: 8px; padding: 10px; margin-bottom: 12px;">
            <div style="font-size: 9px; font-weight: 600; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 6px;">GitHub Copilot Integration</div>
            <p style="font-size: 9px; color: #888; margin-bottom: 8px;">Connect your GitHub account to unlock additional AI models. <strong style="color: #ffa000;">Device Flow recommended</strong> for static sites.</p>
            
            <!-- OAuth Flow Selection -->
            <div style="display: flex; gap: 6px; margin-bottom: 8px;">
                <button id="btnWebFlowAuth" onclick="startWebFlowAuth()" style="flex: 1; padding: 8px; background: linear-gradient(135deg, #444 0%, #333 100%); border: 1px solid #555; border-radius: 6px; color: #ccc; font-size: 10px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 4px;" disabled title="Opens GitHub auth in a popup window">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                        <polyline points="15 3 21 3 21 9"/>
                        <line x1="10" y1="14" x2="21" y2="3"/>
                    </svg>
                    Web (Popup)
                </button>
                <button id="btnDeviceFlowAuth" onclick="startDeviceFlowAuth()" style="flex: 1; padding: 8px; background: linear-gradient(135deg, #00796b 0%, #004d40 100%); border: none; border-radius: 6px; color: white; font-size: 10px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 4px;" disabled>
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="5" y="2" width="14" height="20" rx="2" ry="2"/>
                        <line x1="12" y1="18" x2="12.01" y2="18"/>
                    </svg>
                    Device Code
                </button>
            </div>
            
            <!-- Device Flow Code Display -->
            <div id="deviceFlowSection" style="display: none; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 10px; margin-top: 8px;">
                <p style="font-size: 9px; color: #888; margin-bottom: 6px;">Enter this code at:</p>
                <a id="deviceFlowUri" href="#" target="_blank" style="font-size: 10px; color: #00bfa5; display: block; margin-bottom: 8px; word-break: break-all;"></a>
                <div style="background: #1a1a1a; border-radius: 4px; padding: 12px; text-align: center; margin-bottom: 8px;">
                    <span id="deviceFlowCode" style="font-size: 20px; font-weight: 700; font-family: monospace; letter-spacing: 4px; color: #fff;"></span>
                </div>
                <div id="deviceFlowStatus" style="font-size: 9px; color: #888; text-align: center;"></div>
                <button onclick="cancelDeviceFlow()" style="width: 100%; margin-top: 8px; padding: 6px; background: transparent; border: 1px solid #444; border-radius: 4px; color: #888; font-size: 9px; cursor: pointer;">
                    Cancel
                </button>
            </div>
            
            <!-- Connected Status -->
            <div id="copilotConnectedSection" style="display: none; background: rgba(0,255,0,0.1); border-radius: 6px; padding: 10px;">
                <div style="display: flex; align-items: center; justify-content: space-between;">
                    <span style="font-size: 10px; color: #4caf50; display: flex; align-items: center; gap: 4px;">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                            <polyline points="22 4 12 14.01 9 11.01"/>
                        </svg>
                        Copilot Connected
                    </span>
                    <button onclick="disconnectCopilot()" style="padding: 4px 8px; background: transparent; border: 1px solid #cc0000; border-radius: 4px; color: #cc0000; font-size: 9px; cursor: pointer;">
                        Disconnect
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Market API Modal - Mirrors GitHub Modal Structure -->
<div class="modal-overlay" id="marketApiModal">
    <div class="modal-content" style="max-width: 420px; position: relative;">
        <!-- Close X Button -->
        <button onclick="hideMarketApiModal()" style="position: absolute; top: 10px; right: 10px; background: none; border: none; cursor: pointer; padding: 4px; border-radius: 4px;" aria-label="Close modal">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#888" stroke-width="2" stroke-linecap="round">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
        </button>
        <div class="modal-title">Market API</div>
        <div style="text-align: center; padding: 12px 0;">
            <!-- Starlink-inspired satellite/connection icon -->
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="color: #00bfa5; margin-bottom: 8px;">
                <circle cx="12" cy="12" r="3" fill="currentColor"/>
                <path d="M12 2v3" stroke-linecap="round"/>
                <path d="M12 19v3" stroke-linecap="round"/>
                <path d="M2 12h3" stroke-linecap="round"/>
                <path d="M19 12h3" stroke-linecap="round"/>
                <path d="M4.93 4.93l2.12 2.12" stroke-linecap="round"/>
                <path d="M16.95 16.95l2.12 2.12" stroke-linecap="round"/>
                <path d="M4.93 19.07l2.12-2.12" stroke-linecap="round"/>
                <path d="M16.95 7.05l2.12-2.12" stroke-linecap="round"/>
                <circle cx="12" cy="12" r="8" stroke-dasharray="4 2"/>
            </svg>
        </div>
        
        <!-- Market API Key Section (Coming Soon) -->
        <div style="background: rgba(0,0,0,0.3); border-radius: 8px; padding: 10px; margin-bottom: 12px;">
            <div style="font-size: 9px; font-weight: 600; color: #00bfa5; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 6px;">API Key</div>
            <p style="font-size: 9px; color: #888; margin-bottom: 8px;">Enter your Market Data API key for real-time quotes and data</p>
            <input type="password" class="modal-input" id="marketApiKeyInput" placeholder="Coming Soon..." style="margin-bottom: 8px; opacity: 0.5;" disabled>
            <div style="display: flex; gap: 6px;">
                <button class="modal-btn modal-btn-cancel" onclick="hideMarketApiModal()" style="flex: 1;">Close</button>
                <button class="modal-btn modal-btn-confirm" style="flex: 1; opacity: 0.5;" disabled>Save Key</button>
            </div>
        </div>
        
        <!-- Market Data Server Status -->
        <div style="background: rgba(0,191,165,0.1); border: 1px solid rgba(0,191,165,0.3); border-radius: 8px; padding: 10px; margin-bottom: 12px;">
            <div style="font-size: 9px; font-weight: 600; color: #00bfa5; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 6px;">Data Server Status</div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 3px;">
                <span style="font-size: 10px; color: #888;">Status:</span>
                <span style="font-size: 10px; color: #ffcc00;">â— Coming Soon</span>
            </div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 3px;">
                <span style="font-size: 10px; color: #888;">Real-time Quotes:</span>
                <span style="font-size: 10px; color: #666;">--</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
                <span style="font-size: 10px; color: #888;">Historical Data:</span>
                <span style="font-size: 10px; color: #666;">--</span>
            </div>
        </div>
        
        <!-- Market Data Statistics -->
        <div style="background: rgba(204,0,0,0.1); border: 1px solid rgba(204,0,0,0.3); border-radius: 8px; padding: 10px; margin-bottom: 12px;">
            <div style="font-size: 9px; font-weight: 600; color: #cc0000; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 6px;">Usage Statistics</div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                <div style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 8px; text-align: center;">
                    <div style="font-size: 16px; font-weight: 700; color: #00bfa5;">--</div>
                    <div style="font-size: 8px; color: #666; text-transform: uppercase;">API Calls</div>
                </div>
                <div style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 8px; text-align: center;">
                    <div style="font-size: 16px; font-weight: 700; color: #00bfa5;">--</div>
                    <div style="font-size: 8px; color: #666; text-transform: uppercase;">Data Points</div>
                </div>
                <div style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 8px; text-align: center;">
                    <div style="font-size: 16px; font-weight: 700; color: #00bfa5;">--</div>
                    <div style="font-size: 8px; color: #666; text-transform: uppercase;">Symbols</div>
                </div>
                <div style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 8px; text-align: center;">
                    <div style="font-size: 16px; font-weight: 700; color: #00bfa5;">--</div>
                    <div style="font-size: 8px; color: #666; text-transform: uppercase;">Alerts</div>
                </div>
            </div>
        </div>
        
        <!-- Data Providers (Coming Soon) -->
        <div style="background: rgba(100,100,100,0.1); border: 1px solid rgba(100,100,100,0.2); border-radius: 8px; padding: 10px; margin-bottom: 12px;">
            <div style="font-size: 9px; font-weight: 600; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 6px;">Data Providers</div>
            <p style="font-size: 9px; color: #666; margin-bottom: 8px;">Premium market data integrations coming soon.</p>
            <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                <span style="padding: 4px 8px; background: rgba(0,0,0,0.3); border-radius: 4px; font-size: 9px; color: #666;">Yahoo Finance</span>
                <span style="padding: 4px 8px; background: rgba(0,0,0,0.3); border-radius: 4px; font-size: 9px; color: #666;">Alpha Vantage</span>
                <span style="padding: 4px 8px; background: rgba(0,0,0,0.3); border-radius: 4px; font-size: 9px; color: #666;">Polygon.io</span>
                <span style="padding: 4px 8px; background: rgba(0,0,0,0.3); border-radius: 4px; font-size: 9px; color: #666;">IEX Cloud</span>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript Modules - Loaded in dependency order with defer for non-blocking -->
<!-- 1. Core utilities and configuration -->
<script src="system/js.on/config.js" defer></script>
<script src="system/js.on/utils.js" defer></script>

<!-- 2. UI components -->
<script src="system/js.on/toast.js" defer></script>
<script src="system/js.on/menu.js" defer></script>
<script src="system/js.on/modal.js" defer></script>

<!-- 3. Feature modules -->
<script src="system/js.on/sliders.js" defer></script>
<script src="system/js.on/screenshot.js" defer></script>
<script src="system/js.on/grading.js" defer></script>

<!-- 4. Authentication and models -->
<script src="system/js.on/auth.js" defer></script>
<script src="system/js.on/models.js" defer></script>

<!-- 5. Chat and search functionality -->
<script src="system/js.on/chat.js" defer></script>
<script src="system/js.on/web-search.js" defer></script>

<!-- 6. AI integration -->
<script src="system/js.on/ai.js" defer></script>

<!-- 7. Initialize application -->
<script src="system/js.on/init.js" defer></script>

</body>
</html>
